\chapter[app:installing]{Installing the \nutils}


\section{For the impatient}

\type{$ ./configure && make && sudo make install}

or try \cmake{} (see below).



\section{From source}

\subsection{\cmake{} as an alternative to the Autotools}

Up to now, the \nutils{} have used the \gnu{} autotools as a build system. Since
version 1.7 I have experimented with \cmake{} (\from{URL:CMake}), and found that
I could understand how it works much more easily than I understand the
Autotools. I could get the whole thing to build in no time and with very little
fuss. Of course, you need \cmake{} on your system, while for the \gnu{} system
you only need Make, a Bourne-compatible shell (e.g., Bash or Zsh), GCC, \etc{}
That said, \cmake{} is freely available for Linux, Windows (including Cygwin)
and MacOS.

\subsection{\gnu{} Autotools}

\subsubsection{Prerequisites}

I have tested the \nutils{} on various distributions of Linux, as well as on Mac
OS X and Cygwin\footnote{I use Linux as a main development platform.  Although I
try my best to get the package to compile on Macs and Cygwin, I don't always
succeed.}. On Linux, chances are you already have development tools
preinstalled, but some distributions (\eg, Ubuntu) do not install \cap{gcc},
etc. by default. Check that you have \cap{gcc}, Bison, and Flex. The same goes
for Cygwin. On MacOS X, you need to install XCode (\from{URL:XCode}).

If you're using a non-stable version (such as the one from the Git repository,
as opposed to a tarball), you will probably also need the \gnu{} autotools,
including Libtool.\footnote{It may work without them, it's only that I don't
explicitly {\em try} to make them work independently of the autotools -- that's
what stable releases are for, among other things.}

See \in{}[sct:versions] for version numbers.

\subsubsection[sct:optional]{Optional Software}


If \libxml{} is present on your system, the \nutils{} can use it to
produce better \svg{} graphics. This is the default behaviour, but it is
optional: if the library is not present (or not found), or if you specify not to
use it (see below), the build process will work all the same, and most programs
will not be affected in any way (currently this only affects ornaments to
radial \svg{} trees).

Likewise, the system will build \sched{} unless Guile is not found or you
explicitly disable it (see below). On MacOS (10.6) I had to install it with
Fink, and I needed to use the "x86\_64 only" option when installing Fink
(otherwise the Guile library was 32 bit and the \nutils{} would not link to it).

In the same way, \luaed{} will be built if the Lua headers and libraries are
found and you do not explicitly disable them.

Note that you need {\em both} the library {\em and} the headers for the build
to succeed.

\subsubsection{Build Procedure}
The package uses the \cap{gnu} autotools, like many other open source software packages.\footnote{This does {\em not} mean that you, the user, need to have the autotools installed! In fact the whole point is to be as independent as possible of anything but the plain old Bourne shell.} So all you need to do is the usual
\starttyping
$ tar xzf newick-utils-x.y.z.tar.gz
$ cd newick-utils-x.y.z
$ ./configure
$ make
$ make check
# make install
\stoptyping
The \code{make check} is optional, but you should try it anyway. Note that
the \gen{} test may fail - this is due to differences in pseudo-random number
generators, as far as I can tell.

With non-stable releases, it may be necessary to reconfigure (this generally
does not happen when using the tarball generated by the build system). So if you
get weird error messages, try the following (you'll need the \gnu{} autotools):

\starttyping
$ autoreconf -i
\stoptyping

or even

\starttyping
$ autoreconf -fi
\stoptyping

before launching \code{./configure} as above.

\subsection{Variants}

To prevent the use of \libxml, pass \code{--without-libxml} to
\code{./configure}. Likewise,  pass
\code{--without-guile} or \code{without-lua}, to prevent the use of Guile or
Lua, respectively. 

If you have headers (such as Guile or LibXML's) in a non-standard location, pass
that location via the \code{CPPFLAGS} environment variable when running
\code{./configure}. Likewise, if you have libraries in a non-standard
location, use \code{LDFLAGS}. The syntax is that of the \code{-I} and
\code{-L} options to \code{gcc}, respectively. For example,

\code{LDFLAGS='-L/opt/lib' CPPFLAGS='-I/opt/include' ./configure}

would cause \filename{/opt/lib} and \filename{/opt/include} to be searched for
libraries and headers, respectively. Note that there is no space between the
\code{-I} and the \code{/opt/...}, etc.

\subsection{\cmake{}}

From v. 1.7, the \nutils{} can also be built with \cmake{}
(\from{URL:CMake}).\footnote{This is not the place for advocacy; suffice it
to say that I was impressed by the way \cmake{} worked "out of the box" when I
experimented with it. Some things I never managed to do with
\code{./configure} and friends after several weeks' efforts took around a day
to figure out with \cmake{}.} 

The \cmake{} team encourages {\em out-of-source builds}, that is, instead of
building inside the source tree, you do it outside in another dir. We follow
that convention here as well, buy building in a directory that is in the same
directory as the \nutils{} source dir:

\starttyping
$ ls
...
newick_utils-1.7
...

$ mkdir build_nw_utils
$ cd build_nw_utils
$ cmake ../newick_utils-1.7		# path to the source dir
-- The C compiler identification is GNU
-- Check for working C compiler: /usr/bin/gcc
-- Check for working C compiler: /usr/bin/gcc -- works
-- Detecting C compiler ABI info
-- Detecting C compiler ABI info - done
-- Found BISON: /usr/bin/bison (found version "2.4.1")
-- Found FLEX: /usr/bin/flex (found version "2.5.35")
-- Found LibXml2: /usr/lib64/libxml2.so 
-- Found Lua51: /usr/lib64/liblua-5.1.so;/usr/lib64/libm.so 
-- Configuring done
-- Generating done
-- Build files have been written to: /home/tjunier/projects/build_nutils
\stoptyping

Then it's the usual
\starttyping
$ make
\stoptyping
which in this case produces nice colorized output. This is optionally followed
by 
\starttyping
$ make test
\stoptyping
(NOT \code{make check}, as with the Autotools). Finally, do
\starttyping
$ sudo make install
$ sudo /sbin/ldconfig /usr/local/lib
\stoptyping
The last step is done automatically by the Autotools, but apparently not by
\cmake.

\cmake{} will automatically look for libxml and Lua, and use them if found (see
above). If you want to explicitly disable any optional feature, set the
corresponding \code{USE\_} variable to \code{OFF}, \eg{} to disable Lua (and
not build \luaed), do:

%\starttyping
%$ cmake -D USE_LUA=OFF ../newick_utilities-1.7
%\stoptyping


\section{As binaries}

Since version 1.1, there are also binaries for some platforms. The name of the
archive matches
\filename{newick-utils-<version>-<platform>-<enabled\|disabled>-extra.tar.gz}.
"enabled-extra" means that the binary depends on optional software (see
\in{}[sct:optional])  and will expect to find it (as shared libs) on your
system. "disabled-extra" means that the binary will not depend on those
libraries, but of course the corresponding functionality (see
\in{}[sct:optional]) won't be available. Simply do: 

\starttyping
$ tar xzf newick-utils-<version,etc>.tar.gz
$ cd newick-utils-<version>
\stoptyping

The binaries are in \filename{src}. You can copy/move the binaries
wherever it suits you.\footnote{Ideally, this should be done with \code{make
install}, but for some reason this doesn't seem to work with the binary
release.} You can check the binaries by running \code{test\_binaries.sh}
(though this is not as strict as running the whole test suite after compiling).

\section[sct:versions]{Versions}


Here are the versions I use (as reported by passing
\code{--version} to the program listed in column 2):

\starttabulate[llll]
\NC {\bf tool}	\NC {\bf program} \NC {\bf version} \NC {\bf required for} \NC\NR
\HL \NC\NR
\NC \gnu{} Autoconf	\NC \filename{autoconf}	  	\NC 2.61 		\NC non-stable source \NC\NR
\NC \gnu{} Automake	\NC \filename{automake} 	 	\NC 1.11.1	\NC non-stable source \NC\NR
\NC \gnu{} Bison 		\NC \filename{bison}  			\NC 2.4.1 	\NC source \NC\NR 
\NC Flex						\NC \filename{flex} 				\NC 2.5.35 	\NC source \NC\NR
\NC \gnu{} Guile		\NC \filename{guile}				\NC 1.8.7 	\NC (optional) \NC\NR
\NC GCC 						\NC \filename{gcc}  				\NC 4.4.5 	\NC source \NC\NR
\NC \gnu{} Libtool	\NC \filename{ltmain.sh}  	\NC 2.2.6b 	\NC source \NC\NR
\NC \gnu{} Lua			\NC \filename{ltmain.sh}  	\NC 5.1.4 	\NC (optional) \NC\NR
\NC \libxml{}				\NC \filename{xml2-config}	\NC 2.7.7 	\NC (optional) \NC\NR 
\NC \gnu{} Make			\NC \filename{make}			 		\NC 3.81		\NC source \NC\NR
\stoptabulate

\medskip{}
It may also work with different versions. In case of problems, try to
upgrade to the above.
